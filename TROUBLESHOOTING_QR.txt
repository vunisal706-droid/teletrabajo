# ğŸ” TROUBLESHOOTING: SISTEMA QR NO FUNCIONA

## âœ… PROBLEMA RESUELTO EN ESTA VERSIÃ“N

He mejorado significativamente el sistema de auto-uniÃ³n desde QR con:
- âœ… Logs detallados en consola para debugging
- âœ… Mejor manejo de errores
- âœ… Indicador visual de carga
- âœ… Espera correcta de Firebase
- âœ… URL mejor construida para GitHub Pages
- âœ… Limpieza automÃ¡tica de parÃ¡metros de URL

---

## ğŸ§ª CÃ“MO PROBAR QUE FUNCIONA

### PASO 1: Sube el archivo actualizado a GitHub
- Archivo: `teletrabajo-capitulaciones.html` (126 KB)
- SÃºbelo a la raÃ­z de tu repositorio
- Espera 2-3 minutos para que GitHub Pages actualice

### PASO 2: Crea una reuniÃ³n de prueba
1. Abre la app en tu navegador
2. **IMPORTANTE: Abre la consola del navegador (F12)** - verÃ¡s logs Ãºtiles
3. Introduce tu nombre como coordinador
4. Crea una reuniÃ³n de prueba (cualquier tipo y fecha)
5. AÃ±ade al menos 1 punto al orden del dÃ­a
6. Pulsa "Iniciar ReuniÃ³n" para que la reuniÃ³n exista en la base de datos

### PASO 3: Genera el QR
1. Pulsa "ğŸ“± Generar CitaciÃ³n con QR"
2. VerÃ¡s en consola logs como:
   ```
   ğŸ“± Generando QR con URL: https://...
      - origin: https://tu-usuario.github.io
      - pathname: /tu-repo/teletrabajo-capitulaciones.html
      - baseUrl: https://tu-usuario.github.io/tu-repo/teletrabajo-capitulaciones.html
   âœ… QR generado correctamente
   ```
3. **COPIA LA URL COMPLETA** que aparece en los logs

### PASO 4: Prueba el enlace ANTES de escanear el QR
1. Abre una **ventana de incÃ³gnito** (Ctrl+Shift+N)
2. **Abre la consola (F12) ANTES de pegar la URL**
3. Pega la URL completa (la que copiaste del paso 3)
4. Pulsa Enter

### PASO 5: Observa los logs en consola
DeberÃ­as ver algo como:
```
ğŸ” Verificando parÃ¡metros en URL...
   URL completa: https://...?reunion=Claustro&fecha=2024-11-22
   Search params: ?reunion=Claustro&fecha=2024-11-22
   ParÃ¡metros detectados:
   - reunion: Claustro
   - fecha: 2024-11-22
âœ… ParÃ¡metros vÃ¡lidos detectados, iniciando auto-uniÃ³n...
â³ Esperando a que Firebase se inicialice...
âœ… Firebase listo, procediendo con auto-uniÃ³n
ğŸš€ Ejecutando autoUnirseDesdeQR...
âœ… Nombre proporcionado: Tu Nombre
ğŸ“Š Datos del usuario guardados
ğŸ” Verificando si la reuniÃ³n existe...
âœ… La reuniÃ³n existe
ğŸ‘¤ Registrando participante...
âœ… Participante registrado
ğŸ“º Cambiando a pantalla de reuniÃ³n...
ğŸ“¥ Cargando contenido de la reuniÃ³n...
âœ… Auto-uniÃ³n completada exitosamente
```

### PASO 6: Verifica el resultado
- DeberÃ­as ver un popup pidiendo tu nombre
- DespuÃ©s de introducirlo, deberÃ­as ver la pantalla de reuniÃ³n
- Con el orden del dÃ­a visible
- Y poder participar

---

## âŒ SI SIGUE SIN FUNCIONAR

### ESCENARIO A: No aparece el popup para el nombre
**Problema:** Los parÃ¡metros no se estÃ¡n leyendo de la URL

**Verifica en consola:**
1. Â¿Aparece "ğŸ” Verificando parÃ¡metros en URL..."?
   - Si NO: La funciÃ³n no se ejecutÃ³. Problema con el evento 'load'
   - Si SÃ: ContinÃºa verificando

2. Â¿QuÃ© dice en "URL completa"?
   - Â¿Tiene los parÃ¡metros ?reunion=...&fecha=...?
   - Si NO: El QR se generÃ³ mal, el problema estÃ¡ en generarCitacion

3. Â¿QuÃ© dice en "reunion:" y "fecha:"?
   - Si es NULL: Los parÃ¡metros estÃ¡n pero no se leen bien
   - Si tiene valores: Los parÃ¡metros se leen bien, continÃºa

**SoluciÃ³n:**
- Verifica que la URL en el QR sea correcta
- Debe ser: `https://tu-dominio.com/archivo.html?reunion=XXX&fecha=YYYY-MM-DD`
- NO debe ser: `https://tu-dominio.com/` (sin parÃ¡metros)

### ESCENARIO B: Aparece el popup pero luego nada pasa
**Problema:** Firebase no se conecta o la reuniÃ³n no existe

**Verifica en consola:**
1. Â¿Aparece "âœ… Firebase listo"?
   - Si NO: Firebase no se inicializÃ³. Problema de conexiÃ³n o configuraciÃ³n
   - Si SÃ: Firebase estÃ¡ bien

2. Â¿Aparece "âœ… La reuniÃ³n existe"?
   - Si NO: La reuniÃ³n no existe en la base de datos
   - SoluciÃ³n: El coordinador debe "Iniciar ReuniÃ³n" antes

3. Â¿Aparece algÃºn error en rojo?
   - Si SÃ: Lee el mensaje de error y compÃ¡rtelo

**SoluciÃ³n:**
- AsegÃºrate de que el coordinador ha INICIADO la reuniÃ³n (no solo creado)
- Verifica que la fecha y tipo de reuniÃ³n coinciden exactamente

### ESCENARIO C: Se ve la pantalla pero vacÃ­a
**Problema:** cargarReunion() no funciona correctamente

**Verifica:**
1. Â¿Aparece "âœ… Auto-uniÃ³n completada exitosamente"?
   - Si SÃ: El problema es despuÃ©s, en la carga de contenido
   
2. En la consola, Â¿hay errores relacionados con Firebase?
   - PodrÃ­a ser un problema de permisos o sincronizaciÃ³n

**SoluciÃ³n:**
- Recarga la pÃ¡gina manualmente
- Vuelve a entrar por el mÃ©todo tradicional para verificar que la reuniÃ³n tiene contenido

---

## ğŸ¯ COMANDOS DE DEBUGGING MANUAL

Si quieres probar manualmente en la consola del navegador:

```javascript
// Verificar parÃ¡metros de URL
const params = new URLSearchParams(window.location.search);
console.log('reunion:', params.get('reunion'));
console.log('fecha:', params.get('fecha'));

// Verificar Firebase
console.log('database:', typeof database);
console.log('ref:', typeof ref);

// Verificar variables globales
console.log('sesionActual:', window.sesionActual);
console.log('fechaActual:', window.fechaActual);
console.log('usuarioActual:', window.usuarioActual);

// Probar manualmente la auto-uniÃ³n
autoUnirseDesdeQR('Claustro', '2024-11-22');
```

---

## ğŸ“‹ CHECKLIST DE VERIFICACIÃ“N

Antes de reportar que no funciona, verifica:

- [ ] Has subido el archivo ACTUALIZADO (126 KB, no el anterior de 118-120 KB)
- [ ] Has esperado 2-3 minutos despuÃ©s de subir a GitHub
- [ ] Has limpiado la cachÃ© del navegador o usas modo incÃ³gnito
- [ ] El coordinador ha INICIADO la reuniÃ³n (no solo creado)
- [ ] Hay al menos 1 punto en el orden del dÃ­a
- [ ] La URL en el QR incluye los parÃ¡metros ?reunion=...&fecha=...
- [ ] Tienes la consola del navegador abierta (F12) para ver los logs
- [ ] Has copiado TODOS los logs de la consola para analizarlos

---

## ğŸ’¡ DIFERENCIA ENTRE CREAR E INICIAR

**CREAR reuniÃ³n:** El coordinador configura orden del dÃ­a
**INICIAR reuniÃ³n:** El coordinador pulsa "ğŸš€ Iniciar ReuniÃ³n"

â— **IMPORTANTE:** Los maestros NO pueden unirse (ni por QR ni manualmente) hasta que el coordinador INICIE la reuniÃ³n.

---

## ğŸ†˜ SI NADA DE ESTO FUNCIONA

Comparte en tu consulta:

1. **URL completa que genera el QR** (aparece en consola)
2. **TODOS los logs de consola** desde que pegas la URL
3. **Captura de pantalla** de lo que ves
4. **Â¿Eres el coordinador o maestro?**
5. **Â¿La reuniÃ³n estÃ¡ iniciada o solo creada?**

Con esa informaciÃ³n podrÃ© identificar exactamente dÃ³nde estÃ¡ fallando.

---

## âœ… SOLUCIÃ“N TEMPORAL SI URGE

Si necesitas que funcione YA mientras investigamos:

1. Los maestros pueden unirse manualmente:
   - Abrir app
   - Introducir nombre
   - Seleccionar "Maestro/a"
   - Elegir mismo tipo y fecha de reuniÃ³n
   - Unirse

2. No es tan rÃ¡pido como el QR, pero funciona igual

---

**Ãšltima actualizaciÃ³n:** Noviembre 2024 - VersiÃ³n 3.1 con debugging mejorado
